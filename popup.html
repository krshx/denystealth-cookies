<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Guardr</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
  <script src="chart.js"></script>
  <style>
    :root {
      --bg: #0a0c0f;
      --surface: #111418;
      --surface2: #181c22;
      --border: #1e2530;
      --border2: #252d3a;
      --accent: #ff3b5c;
      --accent-dim: rgba(255, 59, 92, 0.12);
      --accent-glow: rgba(255, 59, 92, 0.25);
      --success: #00e87a;
      --success-dim: rgba(0, 232, 122, 0.1);
      --warn: #ffb800;
      --warn-dim: rgba(255, 184, 0, 0.1);
      --info: #00c8ff;
      --info-dim: rgba(0, 200, 255, 0.1);
      --text: #e8edf5;
      --text-dim: #8a95a8;
      --text-faint: #3d4655;
      --mono: 'Space Mono', monospace;
      --sans: 'DM Sans', sans-serif;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      width: 420px;
      min-height: 200px;
      max-height: 680px;
      background: var(--bg);
      color: var(--text);
      font-family: var(--sans);
      font-size: 13px;
      overflow: hidden;
    }

    /* scanline effect */
    body::before {
      content: '';
      position: fixed; inset: 0;
      background: repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(0,0,0,0.025) 2px, rgba(0,0,0,0.025) 4px);
      pointer-events: none; z-index: 100;
    }

    /* ‚îÄ‚îÄ Header ‚îÄ‚îÄ */
    .header {
      background: var(--surface);
      border-bottom: 1px solid var(--border);
      padding: 14px 16px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      position: relative;
      overflow: hidden;
    }
    .header::after {
      content: '';
      position: absolute; bottom: 0; left: 0; right: 0; height: 1px;
      background: linear-gradient(90deg, transparent, var(--accent), transparent);
      opacity: 0.5;
    }

    .logo { display: flex; align-items: center; gap: 10px; }
    .logo-icon {
      width: 32px; height: 32px;
      background: var(--accent-dim);
      border: 1px solid rgba(255, 59, 92, 0.3);
      border-radius: 8px;
      display: flex; align-items: center; justify-content: center;
      font-size: 17px; flex-shrink: 0;
    }
    .logo-text { display: flex; flex-direction: column; }
    .logo-name {
      font-family: var(--mono); font-size: 14px; font-weight: 700;
      color: var(--accent); letter-spacing: 0.05em; line-height: 1;
    }
    .logo-sub { font-size: 10px; color: var(--text-dim); letter-spacing: 0.08em; text-transform: uppercase; margin-top: 2px; }

    .site-info { text-align: right; max-width: 180px; }
    .site-domain { font-family: var(--mono); font-size: 10px; color: var(--text-dim); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .cmp-badge {
      display: inline-block; font-size: 9px; font-family: var(--mono);
      background: var(--accent-dim); color: var(--accent);
      border: 1px solid rgba(255,59,92,0.2); border-radius: 3px;
      padding: 1px 5px; margin-top: 3px; letter-spacing: 0.05em; text-transform: uppercase;
    }
    .auto-mode-badge {
      display: none; font-size: 9px; font-family: var(--mono);
      background: rgba(0,232,122,0.15); color: var(--success);
      border: 1px solid rgba(0,232,122,0.3); border-radius: 3px;
      padding: 2px 6px; margin-top: 3px; letter-spacing: 0.05em;
      animation: pulse 2s ease-in-out infinite;
    }
    .auto-mode-badge.active { display: inline-block; }
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.6; }
    }

    /* ‚îÄ‚îÄ Status ‚îÄ‚îÄ */
    .action-area { padding: 14px 16px 16px; }

    .scan-status {
      background: var(--surface2); border: 1px solid var(--border);
      border-radius: 10px; padding: 12px 14px; margin-bottom: 12px;
      display: flex; align-items: center; gap: 12px;
    }
    .status-dot {
      width: 8px; height: 8px; border-radius: 50%;
      background: var(--text-faint); flex-shrink: 0; transition: background 0.3s;
    }
    .status-dot.ready   { background: var(--warn); box-shadow: 0 0 8px var(--warn); }
    .status-dot.running { background: var(--info); box-shadow: 0 0 8px var(--info); animation: pulse 1s infinite; }
    .status-dot.done    { background: var(--success); box-shadow: 0 0 8px var(--success); }
    .status-dot.error   { background: var(--accent); box-shadow: 0 0 8px var(--accent); }

    @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:0.3} }

    .status-text { flex: 1; }
    .status-label { font-size: 12px; font-weight: 600; color: var(--text); line-height: 1.3; }
    .status-detail { font-family: var(--mono); font-size: 10px; color: var(--text-dim); margin-top: 2px; }

    /* ‚îÄ‚îÄ No CMP notice ‚îÄ‚îÄ */
    .no-cmp-notice {
      margin-bottom: 12px; background: var(--surface2);
      border: 1px solid rgba(255,184,0,0.2); border-radius: 8px;
      padding: 10px 12px; display: none;
    }
    .no-cmp-notice.visible { display: block; }
    .no-cmp-title { font-family: var(--mono); font-size: 11px; color: var(--warn); font-weight: 700; margin-bottom: 3px; }
    .no-cmp-text { font-size: 11px; color: var(--text-dim); line-height: 1.5; }

    /* ‚îÄ‚îÄ Deny Button ‚îÄ‚îÄ */
    .deny-btn {
      width: 100%;
      background: linear-gradient(135deg, #c0392b 0%, #ff3b5c 60%, #ff6b6b 100%);
      color: #fff;
      border: none; border-radius: 10px;
      padding: 15px 20px;
      font-family: var(--mono); font-size: 13px; font-weight: 700;
      letter-spacing: 0.1em; text-transform: uppercase;
      cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 9px;
      transition: all 0.2s; position: relative; overflow: hidden;
    }
    .deny-btn::before {
      content: ''; position: absolute; inset: 0;
      background: linear-gradient(135deg, transparent 30%, rgba(255,255,255,0.12) 50%, transparent 70%);
      transform: translateX(-100%); transition: transform 0.4s;
    }
    .deny-btn:hover::before { transform: translateX(100%); }
    .deny-btn:hover { box-shadow: 0 0 28px rgba(255,59,92,0.45); transform: translateY(-1px); }
    .deny-btn:active { transform: translateY(0); box-shadow: none; }
    .deny-btn:disabled {
      background: var(--surface2); color: var(--text-faint);
      cursor: not-allowed; box-shadow: none; transform: none; border: 1px solid var(--border);
    }
    .deny-btn.running {
      background: var(--surface2); color: var(--info);
      border: 1px solid var(--border); cursor: wait;
    }
    .deny-btn.done-state {
      background: var(--surface2); color: var(--success);
      border: 1px solid rgba(0,232,122,0.25); cursor: default;
    }

    .spinner {
      width: 14px; height: 14px; border: 2px solid currentColor;
      border-top-color: transparent; border-radius: 50%;
      animation: spin 0.8s linear infinite; display: none;
    }
    .deny-btn.running .spinner { display: block; }
    .deny-btn.running .btn-icon { display: none; }
    @keyframes spin { to { transform: rotate(360deg); } }

    /* ‚îÄ‚îÄ Teach Button ‚îÄ‚îÄ */
    .teach-btn {
      width: 100%;
      background: var(--surface2);
      color: var(--info);
      border: 1px solid var(--border2);
      border-radius: 8px;
      padding: 10px 16px;
      margin-top: 8px;
      font-family: var(--sans);
      font-size: 12px;
      font-weight: 500;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      transition: all 0.2s;
    }
    .teach-btn:hover {
      background: var(--info-dim);
      border-color: var(--info);
      color: var(--info);
      box-shadow: 0 0 16px rgba(0, 200, 255, 0.15);
    }
    .teach-btn:active {
      transform: scale(0.98);
    }
    .teach-btn.teaching-active {
      background: var(--info-dim);
      border-color: var(--info);
      color: var(--info);
      animation: pulse 2s ease-in-out infinite;
    }

    /* ‚îÄ‚îÄ Learned Patterns Section ‚îÄ‚îÄ */
    .learned-patterns-section {
      margin: 12px 16px;
      padding: 12px;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 8px;
    }
    .learned-patterns-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 8px;
      padding-bottom: 8px;
      border-bottom: 1px solid var(--border);
      font-size: 11px;
      font-weight: 600;
      color: var(--text);
    }
    .clear-patterns-btn {
      background: none;
      border: 1px solid var(--border2);
      color: var(--text-dim);
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 10px;
      cursor: pointer;
      transition: all 0.2s;
    }
    .clear-patterns-btn:hover {
      background: var(--accent-dim);
      border-color: var(--accent);
      color: var(--accent);
    }

    /* ‚îÄ‚îÄ Dashboard/Analytics ‚îÄ‚îÄ */
    .dashboard-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 12px;
      padding: 12px;
    }
    .chart-card {
      background: var(--surface2);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 12px;
    }
    .chart-title {
      font-family: var(--mono);
      font-size: 11px;
      font-weight: 600;
      color: var(--text);
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .chart-container {
      position: relative;
      height: 180px;
      margin-bottom: 8px;
    }
    .chart-container.small {
      height: 140px;
    }
    .dashboard-stats {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 8px;
      margin-bottom: 12px;
    }
    .dashboard-stat {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 6px;
      padding: 10px;
      text-align: center;
    }
    .dashboard-stat-value {
      font-family: var(--mono);
      font-size: 20px;
      font-weight: 700;
      color: var(--success);
      line-height: 1;
      margin-bottom: 4px;
    }
    .dashboard-stat-value.warning { color: var(--warn); }
    .dashboard-stat-value.error { color: var(--accent); }
    .dashboard-stat-value.learning { color: #9333ea; }
    .dashboard-stat-label {
      font-size: 10px;
      color: var(--text-dim);
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    /* ‚îÄ‚îÄ Learned Patterns ‚îÄ‚îÄ */
    .learned-patterns-list {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
    .learned-pattern-item {
      padding: 8px;
      background: var(--surface2);
      border: 1px solid var(--border);
      border-radius: 6px;
      font-size: 11px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
    }
    .learned-pattern-text {
      flex: 1;
      font-family: var(--mono);
      color: var(--text);
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
    .learned-pattern-meta {
      font-size: 9px;
      color: var(--text-dim);
      white-space: nowrap;
    }
    .learned-pattern-badge {
      background: var(--success-dim);
      color: var(--success);
      padding: 2px 6px;
      border-radius: 3px;
      font-size: 9px;
      font-family: var(--mono);
      letter-spacing: 0.05em;
    }

    /* ‚îÄ‚îÄ Results ‚îÄ‚îÄ */
    .results-section {
      border-top: 1px solid var(--border);
      max-height: 0; overflow: hidden; transition: max-height 0.4s ease;
    }
    .results-section.visible { max-height: 420px; overflow-y: auto; }
    .results-section::-webkit-scrollbar { width: 4px; }
    .results-section::-webkit-scrollbar-track { background: var(--bg); }
    .results-section::-webkit-scrollbar-thumb { background: var(--border2); border-radius: 2px; }

    /* Banner closed pill */
    .banner-status {
      margin: 0 16px 0;
      display: none;
      padding: 7px 12px;
      border-radius: 0 0 8px 8px;
      font-family: var(--mono);
      font-size: 10px;
      letter-spacing: 0.05em;
      text-align: center;
    }
    .banner-status.closed {
      display: block;
      background: var(--success-dim);
      color: var(--success);
      border: 1px solid rgba(0,232,122,0.2);
      border-top: none;
    }
    .banner-status.not-closed {
      display: block;
      background: var(--warn-dim);
      color: var(--warn);
      border: 1px solid rgba(255,184,0,0.2);
      border-top: none;
    }

    /* Stats bar */
    .stats-bar {
      display: grid; grid-template-columns: 1fr 1fr 1fr;
      gap: 1px; background: var(--border); border-top: 1px solid var(--border);
    }
    .stat-cell { background: var(--surface); padding: 10px 12px; text-align: center; }
    .stat-value { font-family: var(--mono); font-size: 20px; font-weight: 700; line-height: 1; margin-bottom: 3px; }
    .stat-value.v-removed { color: var(--accent); }
    .stat-value.v-kept    { color: var(--warn); }
    .stat-value.v-errors  { color: var(--text-dim); }
    .stat-label { font-size: 9px; color: var(--text-dim); text-transform: uppercase; letter-spacing: 0.08em; }

    /* Tabs */
    .result-tabs { display: flex; background: var(--surface); border-bottom: 1px solid var(--border); }
    .tab-btn {
      flex: 1; padding: 9px 8px; background: none; border: none;
      color: var(--text-dim); font-family: var(--mono); font-size: 10px;
      font-weight: 700; text-transform: uppercase; letter-spacing: 0.06em;
      cursor: pointer; border-bottom: 2px solid transparent; transition: all 0.2s;
    }
    .tab-btn:hover { color: var(--text); }
    .tab-btn.active         { color: var(--accent); border-bottom-color: var(--accent); background: var(--accent-dim); }
    .tab-btn.tab-kept.active  { color: var(--warn);   border-bottom-color: var(--warn);   background: var(--warn-dim); }
    .tab-btn.tab-err.active   { color: var(--text-dim);border-bottom-color: var(--text-dim);background: var(--surface2); }

    .tab-panel { display: none; padding: 8px; }
    .tab-panel.active { display: block; }

    .result-empty { padding: 20px; text-align: center; color: var(--text-faint); font-size: 11px; font-family: var(--mono); line-height: 1.6; }

    .result-item {
      display: flex; align-items: flex-start; gap: 8px;
      padding: 8px 10px; border-radius: 6px; margin-bottom: 4px;
      background: var(--surface2); border: 1px solid var(--border);
      transition: border-color 0.15s;
    }
    .result-item:hover { border-color: var(--border2); }
    .result-item:last-child { margin-bottom: 0; }
    .item-icon { font-size: 12px; flex-shrink: 0; margin-top: 1px; }
    .item-body { flex: 1; min-width: 0; }
    .item-label { font-size: 11.5px; color: var(--text); line-height: 1.4; word-break: break-word; }
    .item-cat {
      display: inline-block; font-family: var(--mono); font-size: 9px;
      background: var(--surface); border: 1px solid var(--border);
      border-radius: 3px; padding: 1px 5px; margin-top: 3px;
      text-transform: uppercase; letter-spacing: 0.05em; color: var(--text-faint);
    }
    .item-cat.consent     { color: var(--accent);  border-color: rgba(255,59,92,0.2);   background: var(--accent-dim); }
    .item-cat.legitimate  { color: var(--warn);    border-color: rgba(255,184,0,0.2);   background: var(--warn-dim); }
    .item-cat.vendor      { color: #a78bfa;        border-color: rgba(167,139,250,0.2); background: rgba(167,139,250,0.08); }
    .item-cat.mandatory   { color: var(--warn);    border-color: rgba(255,184,0,0.2);   background: var(--warn-dim); }

    /* Settings */
    .settings-toggle { background:none;border:none;cursor:pointer;color:var(--text-faint);font-size:14px;padding:0 4px;transition:color 0.2s; }
    .settings-toggle:hover { color:var(--text-dim); }
    .settings-drawer { background:var(--surface);border-top:1px solid var(--border);max-height:0;overflow:hidden;transition:max-height 0.3s ease; }
    .settings-drawer.open { max-height:220px; }
    .settings-inner { padding:10px 16px; }
    .setting-row { display:flex;align-items:center;justify-content:space-between;padding:7px 0;border-bottom:1px solid var(--border); }
    .setting-row:last-child { border-bottom:none; }
    .setting-label { font-size:12px;color:var(--text-dim);flex:1; }
    .setting-sub   { font-size:10px;color:var(--text-faint);margin-top:1px; }
    .toggle-switch { position:relative;width:36px;height:20px;flex-shrink:0; }
    .toggle-switch input { opacity:0;width:0;height:0; }
    .toggle-slider { position:absolute;inset:0;background:var(--border2);border-radius:10px;cursor:pointer;transition:0.2s; }
    .toggle-slider::before { content:'';position:absolute;height:14px;width:14px;left:3px;bottom:3px;background:white;border-radius:50%;transition:0.2s; }
    input:checked + .toggle-slider { background:var(--accent); }
    input:checked + .toggle-slider::before { transform:translateX(16px); }
    /* Donation */
    .donation-bar { background:linear-gradient(135deg,rgba(255,59,92,0.07),rgba(255,59,92,0.03));border-top:1px solid rgba(255,59,92,0.15);padding:8px 16px;display:flex;align-items:center;justify-content:space-between;gap:10px; }
    .donation-text { font-size:11px;color:var(--text-dim);flex:1; }
    .donation-btn { background:none;border:1px solid rgba(255,59,92,0.3);color:var(--accent);border-radius:5px;padding:4px 10px;font-size:10px;font-family:var(--mono);font-weight:700;cursor:pointer;letter-spacing:0.05em;white-space:nowrap;text-decoration:none;display:inline-block;transition:all 0.2s; }
    .donation-btn:hover { background:rgba(255,59,92,0.1);border-color:var(--accent); }

    /* Contextual donation prompt */
    .donation-prompt { background:linear-gradient(135deg,rgba(255,184,0,0.08),rgba(255,184,0,0.03));border-top:1px solid rgba(255,184,0,0.2);padding:12px 16px;position:relative; }
    .donation-prompt-content { display:flex;align-items:center;gap:12px; }
    .donation-prompt-icon { font-size:24px;flex-shrink:0; }
    .donation-prompt-text { flex:1; }
    .donation-prompt-title { font-size:12px;font-weight:600;color:var(--text);margin-bottom:2px; }
    .donation-prompt-sub { font-size:10px;color:var(--text-dim); }
    .donation-prompt-actions { display:flex;gap:6px;flex-shrink:0; }
    .donation-quick-btn { background:rgba(255,184,0,0.15);border:1px solid rgba(255,184,0,0.3);color:var(--warn);border-radius:4px;padding:6px 12px;font-size:10px;font-family:var(--mono);font-weight:700;cursor:pointer;letter-spacing:0.05em;white-space:nowrap;text-decoration:none;display:inline-block;transition:all 0.2s; }
    .donation-quick-btn:hover { background:rgba(255,184,0,0.25);border-color:var(--warn);transform:translateY(-1px); }
    .donation-prompt-dismiss { position:absolute;top:8px;right:8px;background:none;border:none;color:var(--text-faint);font-size:18px;cursor:pointer;padding:0;width:20px;height:20px;line-height:20px;text-align:center;transition:color 0.2s; }
    .donation-prompt-dismiss:hover { color:var(--text); }

    /* History */
    .history-header { display:flex;justify-content:space-between;align-items:center;padding:10px 12px;border-bottom:1px solid var(--border); }
    .history-stats { font-size:11px;color:var(--text-dim);font-family:var(--mono); }
    .clear-history-btn { background:none;border:1px solid var(--border2);color:var(--text-dim);border-radius:4px;padding:4px 8px;font-size:9px;cursor:pointer;transition:all 0.2s; }
    .clear-history-btn:hover { border-color:var(--accent);color:var(--accent); }
    .history-list { max-height:280px;overflow-y:auto; }
    .history-item { padding:10px 12px;border-bottom:1px solid var(--border);transition:background 0.2s; }
    .history-item:hover { background:rgba(255,59,92,0.03); }
    .history-item-header { display:flex;justify-content:space-between;align-items:start;margin-bottom:4px; }
    .history-item-domain { font-size:11px;font-family:var(--mono);color:var(--text);font-weight:500;display:flex;align-items:center;gap:6px; }
    .history-item-date { font-size:9px;color:var(--text-faint);font-family:var(--mono); }
    .history-item-stats { display:flex;gap:12px;font-size:10px;color:var(--text-dim);flex-wrap:wrap; }
    .history-item-stat { display:flex;align-items:center;gap:4px; }
    .history-item-stat-icon { font-size:10px; }
    .history-item-stat-icon.success { color:var(--success); }
    .history-item-stat-icon.warn { color:var(--warn); }
    .tab-history { border-left:1px solid var(--border2); }
    
    /* Consent-or-pay badge */
    .consent-or-pay-badge {
      display:inline-block;background:var(--warn-dim);border:1px solid var(--warn);
      color:var(--warn);font-size:8px;padding:2px 5px;border-radius:3px;
      text-transform:uppercase;font-weight:700;letter-spacing:0.5px;
    }
    
    /* Action log */
    .history-item-expand { margin-top:6px; }
    .expand-log-btn {
      background:var(--surface);border:1px solid var(--border2);color:var(--text-dim);
      border-radius:4px;padding:3px 8px;font-size:9px;cursor:pointer;
      transition:all 0.2s;display:flex;align-items:center;gap:4px;font-family:var(--mono);
    }
    .expand-log-btn:hover { border-color:var(--info);color:var(--info); }
    .expand-icon { font-size:8px;transition:transform 0.2s; }
    .history-action-log {
      margin-top:8px;padding:8px;background:var(--surface);
      border:1px solid var(--border2);border-radius:4px;
    }
    .action-log-title {
      font-size:9px;font-weight:700;color:var(--text-dim);margin-bottom:4px;
      text-transform:uppercase;letter-spacing:0.5px;font-family:var(--mono);
    }
    .action-log-entry {
      display:flex;gap:8px;padding:3px 0;font-size:9px;font-family:var(--mono);
      border-bottom:1px solid var(--border);line-height:1.4;
    }
    .action-log-entry:last-child { border-bottom:none; }
    .action-log-time { color:var(--text-faint);min-width:50px;flex-shrink:0; }
    .action-log-action { color:var(--text-dim);word-break:break-word; }
    .dismiss-btn { background:none;border:none;color:var(--text-faint);cursor:pointer;font-size:14px;padding:0;line-height:1; }
    .dismiss-btn:hover { color:var(--text-dim); }
    /* Footer */
    .footer {
      background: var(--surface); border-top: 1px solid var(--border);
      padding: 7px 16px; display: flex; align-items: center; justify-content: space-between;
    }
    .footer-time { font-family: var(--mono); font-size: 9px; color: var(--text-faint); }
    .footer-note { font-size: 9px; color: var(--text-faint); }
  </style>
</head>
<body>

  <div class="header">
    <div class="logo">
      <div class="logo-icon">ÔøΩÔ∏è</div>
      <div class="logo-text">
        <div class="logo-name">GUARDR</div>
        <div class="logo-sub">Privacy Guardian</div>
      </div>
    </div>
    <div class="site-info">
      <div class="site-domain" id="siteDomain">‚Äî</div>
      <div id="cmpBadgeWrap"></div>
      <div class="auto-mode-badge" id="autoModeBadge">‚ö° AUTO-ACTIVE</div>
    </div>
  </div>

  <div class="action-area">
    <div class="scan-status">
      <div class="status-dot" id="statusDot"></div>
      <div class="status-text">
        <div class="status-label" id="statusLabel">Ready to deny all consents</div>
        <div class="status-detail" id="statusDetail">Guardr removes non-essential tracking &amp; keeps only mandatory cookies</div>
      </div>
    </div>

    <div class="no-cmp-notice" id="noCmpNotice">
      <div class="no-cmp-title">‚ö† No standard CMP detected</div>
      <div class="no-cmp-text">No recognised consent banner found. Guardr will still attempt to uncheck any toggles found on the page.</div>
    </div>

    <button class="deny-btn" id="denyBtn">
      <span class="btn-icon">üö´</span>
      <span class="spinner"></span>
      <span id="btnText">Deny All Non-Essential Consents</span>
    </button>
    
    <!-- Teaching mode button -->
    <button class="teach-btn" id="teachBtn" title="Teach the extension which button to click">
      <span class="btn-icon">üéØ</span>
      <span id="teachBtnText">Extension Missed a Popup?</span>
    </button>
  </div>

  <!-- Learned patterns section -->
  <div class="learned-patterns-section" id="learnedPatternsSection" style="display: none;">
    <div class="learned-patterns-header">
      <span>üìö Learned Patterns for This Site</span>
      <button class="clear-patterns-btn" id="clearPatternsBtn" title="Clear learned patterns">Clear</button>
    </div>
    <div class="learned-patterns-list" id="learnedPatternsList"></div>
  </div>

  <!-- Banner closed status (shown below button after scan) -->
  <div class="banner-status" id="bannerStatus"></div>

  <div class="results-section" id="resultsSection">
    <div class="stats-bar">
      <div class="stat-cell">
        <div class="stat-value v-removed" id="statRemoved">0</div>
        <div class="stat-label">Denied</div>
      </div>
      <div class="stat-cell">
        <div class="stat-value v-kept" id="statKept">0</div>
        <div class="stat-label">Kept (essential)</div>
      </div>
      <div class="stat-cell">
        <div class="stat-value v-errors" id="statErrors">0</div>
        <div class="stat-label">Errors</div>
      </div>
    </div>

    <div class="result-tabs">
      <button class="tab-btn active" data-tab="removed" id="tabRemoved">üö´ Denied</button>
      <button class="tab-btn tab-kept" data-tab="kept" id="tabKept">üîí Kept</button>
      <button class="tab-btn tab-err" data-tab="errors" id="tabErrors">‚ö† Errors</button>
      <button class="tab-btn tab-history" data-tab="history" id="tabHistory">üìä History</button>
      <button class="tab-btn tab-dashboard" data-tab="dashboard" id="tabDashboard">üìà Analytics</button>
    </div>

    <div class="tab-panel active" id="panelRemoved">
      <div class="result-empty">Nothing denied yet.</div>
    </div>
    <div class="tab-panel" id="panelKept">
      <div class="result-empty">No essential items detected yet.</div>
    </div>
    <div class="tab-panel" id="panelErrors">
      <div class="result-empty">No errors.</div>
    </div>
    <div class="tab-panel" id="panelHistory">
      <div class="history-header">
        <div class="history-stats" id="historyStats"></div>
        <button class="clear-history-btn" id="clearHistoryBtn">Clear All</button>
      </div>
      <div class="filter-indicator" id="filterIndicator" style="display:none;">
        <span class="filter-text" id="filterText"></span>
        <button class="filter-clear-btn" id="clearFilterBtn" title="Clear filter">‚úï</button>
      </div>
      <div class="history-list" id="historyList">
        <div class="result-empty">No history yet. Start denying consents!</div>
      </div>
    </div>
    <div class="tab-panel" id="panelDashboard">
      <div class="dashboard-grid">
        <div class="dashboard-stats">
          <div class="dashboard-stat">
            <div class="dashboard-stat-value" id="totalDenials">0</div>
            <div class="dashboard-stat-label">Total Denials</div>
          </div>
          <div class="dashboard-stat">
            <div class="dashboard-stat-value" id="successRate">0%</div>
            <div class="dashboard-stat-label">Success Rate</div>
          </div>
          <div class="dashboard-stat">
            <div class="dashboard-stat-value warning" id="partialDenials">0</div>
            <div class="dashboard-stat-label">Partial</div>
          </div>
          <div class="dashboard-stat">
            <div class="dashboard-stat-value error" id="failedDenials">0</div>
            <div class="dashboard-stat-label">Failed</div>
          </div>
        </div>
        <div class="chart-card">
          <div class="chart-title">üéØ Denial Success Overview</div>
          <div class="chart-container small">
            <canvas id="successChart"></canvas>
          </div>
        </div>
        <div class="chart-card">
          <div class="chart-title">üìä Denial Types</div>
          <div class="chart-container small">
            <canvas id="typesChart"></canvas>
          </div>
        </div>
        <div class="chart-card">
          <div class="chart-title">üìà Activity Over Time (Last 30 Days)</div>
          <div class="chart-container">
            <canvas id="timelineChart"></canvas>
          </div>
        </div>
        <div class="chart-card">
          <div class="chart-title">üèÜ Top Sites by Denials</div>
          <div class="chart-container">
            <canvas id="topSitesChart"></canvas>
          </div>
        </div>
        
        <!-- Learning Analytics Section -->
        <div class="chart-card" style="border-color: rgba(147, 51, 234, 0.3);">
          <div class="chart-title">üß† Learning Analytics</div>
          <div class="dashboard-stats" style="margin-bottom: 16px;">
            <div class="dashboard-stat">
              <div class="dashboard-stat-value learning" id="totalLearnedPatterns">0</div>
              <div class="dashboard-stat-label">Patterns</div>
            </div>
            <div class="dashboard-stat">
              <div class="dashboard-stat-value learning" id="learningSites">0</div>
              <div class="dashboard-stat-label">Sites</div>
            </div>
            <div class="dashboard-stat">
              <div class="dashboard-stat-value learning" id="avgConfidence">0%</div>
              <div class="dashboard-stat-label">Avg Confidence</div>
            </div>
            <div class="dashboard-stat">
              <div class="dashboard-stat-value learning" id="promotedPatterns">0</div>
              <div class="dashboard-stat-label">Promoted</div>
            </div>
          </div>
          <div id="learningPatternsView" style="max-height: 300px; overflow-y: auto;">
            <!-- Populated by JavaScript -->
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Contextual donation prompt (appears after successful denials) -->
  <div class="donation-prompt" id="donationPrompt" style="display:none">
    <div class="donation-prompt-content">
      <div class="donation-prompt-icon">‚òï</div>
      <div class="donation-prompt-text">
        <div class="donation-prompt-title" id="donationPromptTitle">Enjoying Guardr?</div>
        <div class="donation-prompt-sub">Free & open source ‚Ä¢ No ads ‚Ä¢ Your privacy protected</div>
      </div>
      <div class="donation-prompt-actions">
        <a class="donation-quick-btn" href="https://paypal.me/getkrisboy" target="_blank" title="Quick donate via PayPal">$ PayPal</a>
        <a class="donation-quick-btn" href="https://ko-fi.com/krshx" target="_blank" title="Buy me a coffee">‚òï Ko-fi</a>
      </div>
    </div>
    <button class="donation-prompt-dismiss" id="dismissDonationPrompt" title="Remind me in 14 days">√ó</button>
  </div>

  <div class="footer">
    <div class="footer-time" id="footerTime"></div>
    <div style="display:flex;align-items:center;gap:8px;">
      <button class="settings-toggle" id="settingsToggle" title="Settings">&#9881;</button>
      <div class="footer-note">Guardr v2.1.4</div>
    </div>
  </div>

  <!-- Donation bar -->
  <div class="donation-bar" id="donationBar" style="display:none">
    <div class="donation-text">&#10084; Free &amp; open source</div>
    <a class="donation-btn" href="https://paypal.me/getkrisboy" target="_blank">&#36; PayPal</a>
    <a class="donation-btn" href="https://ko-fi.com/krshx" target="_blank">&#9749; Ko-fi</a>
    <button class="dismiss-btn" id="dismissDonation" title="Remind me in 14 days">&#215;</button>
  </div>

  <!-- Settings drawer -->
  <div class="settings-drawer" id="settingsDrawer">
    <div class="settings-inner">
      <div class="setting-row">
        <div>
          <div class="setting-label">Anonymous telemetry</div>
          <div class="setting-sub">CMP type + count only. No URLs, no personal data. Off by default.</div>
        </div>
        <label class="toggle-switch">
          <input type="checkbox" id="telemetryToggle">
          <span class="toggle-slider"></span>
        </label>
      </div>
      <div class="setting-row">
        <div>
          <div class="setting-label">Auto-deny mode</div>
          <div class="setting-sub">Automatically denies banners as they appear (zero clicks needed, shows ‚úì badge on success)</div>
        </div>
        <label class="toggle-switch">
          <input type="checkbox" id="autoModeToggle">
          <span class="toggle-slider"></span>
        </label>
      </div>
      <div class="setting-row">
        <div style="flex:1">
          <div class="setting-label">Privacy policy</div>
        </div>
        <a href="https://krshx.github.io/denystealth-cookies/" target="_blank"
           style="font-size:10px;color:var(--accent);font-family:var(--mono);">View &#8599;</a>
      </div>
    </div>
  </div>

  <script src="popup.js"></script>
</body>
</html>
