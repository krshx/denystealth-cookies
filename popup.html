<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DenyStealthCookies</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #0a0c0f;
      --surface: #111418;
      --surface2: #181c22;
      --border: #1e2530;
      --border2: #252d3a;
      --accent: #ff3b5c;
      --accent-dim: rgba(255, 59, 92, 0.12);
      --accent-glow: rgba(255, 59, 92, 0.25);
      --success: #00e87a;
      --success-dim: rgba(0, 232, 122, 0.1);
      --warn: #ffb800;
      --warn-dim: rgba(255, 184, 0, 0.1);
      --info: #00c8ff;
      --info-dim: rgba(0, 200, 255, 0.1);
      --text: #e8edf5;
      --text-dim: #8a95a8;
      --text-faint: #3d4655;
      --mono: 'Space Mono', monospace;
      --sans: 'DM Sans', sans-serif;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      width: 420px;
      min-height: 200px;
      max-height: 680px;
      background: var(--bg);
      color: var(--text);
      font-family: var(--sans);
      font-size: 13px;
      overflow: hidden;
    }

    /* scanline effect */
    body::before {
      content: '';
      position: fixed; inset: 0;
      background: repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(0,0,0,0.025) 2px, rgba(0,0,0,0.025) 4px);
      pointer-events: none; z-index: 100;
    }

    /* â”€â”€ Header â”€â”€ */
    .header {
      background: var(--surface);
      border-bottom: 1px solid var(--border);
      padding: 14px 16px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      position: relative;
      overflow: hidden;
    }
    .header::after {
      content: '';
      position: absolute; bottom: 0; left: 0; right: 0; height: 1px;
      background: linear-gradient(90deg, transparent, var(--accent), transparent);
      opacity: 0.5;
    }

    .logo { display: flex; align-items: center; gap: 10px; }
    .logo-icon {
      width: 32px; height: 32px;
      background: var(--accent-dim);
      border: 1px solid rgba(255, 59, 92, 0.3);
      border-radius: 8px;
      display: flex; align-items: center; justify-content: center;
      font-size: 17px; flex-shrink: 0;
    }
    .logo-text { display: flex; flex-direction: column; }
    .logo-name {
      font-family: var(--mono); font-size: 14px; font-weight: 700;
      color: var(--accent); letter-spacing: 0.05em; line-height: 1;
    }
    .logo-sub { font-size: 10px; color: var(--text-dim); letter-spacing: 0.08em; text-transform: uppercase; margin-top: 2px; }

    .site-info { text-align: right; max-width: 180px; }
    .site-domain { font-family: var(--mono); font-size: 10px; color: var(--text-dim); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .cmp-badge {
      display: inline-block; font-size: 9px; font-family: var(--mono);
      background: var(--accent-dim); color: var(--accent);
      border: 1px solid rgba(255,59,92,0.2); border-radius: 3px;
      padding: 1px 5px; margin-top: 3px; letter-spacing: 0.05em; text-transform: uppercase;
    }

    /* â”€â”€ Status â”€â”€ */
    .action-area { padding: 14px 16px 16px; }

    .scan-status {
      background: var(--surface2); border: 1px solid var(--border);
      border-radius: 10px; padding: 12px 14px; margin-bottom: 12px;
      display: flex; align-items: center; gap: 12px;
    }
    .status-dot {
      width: 8px; height: 8px; border-radius: 50%;
      background: var(--text-faint); flex-shrink: 0; transition: background 0.3s;
    }
    .status-dot.ready   { background: var(--warn); box-shadow: 0 0 8px var(--warn); }
    .status-dot.running { background: var(--info); box-shadow: 0 0 8px var(--info); animation: pulse 1s infinite; }
    .status-dot.done    { background: var(--success); box-shadow: 0 0 8px var(--success); }
    .status-dot.error   { background: var(--accent); box-shadow: 0 0 8px var(--accent); }

    @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:0.3} }

    .status-text { flex: 1; }
    .status-label { font-size: 12px; font-weight: 600; color: var(--text); line-height: 1.3; }
    .status-detail { font-family: var(--mono); font-size: 10px; color: var(--text-dim); margin-top: 2px; }

    /* â”€â”€ No CMP notice â”€â”€ */
    .no-cmp-notice {
      margin-bottom: 12px; background: var(--surface2);
      border: 1px solid rgba(255,184,0,0.2); border-radius: 8px;
      padding: 10px 12px; display: none;
    }
    .no-cmp-notice.visible { display: block; }
    .no-cmp-title { font-family: var(--mono); font-size: 11px; color: var(--warn); font-weight: 700; margin-bottom: 3px; }
    .no-cmp-text { font-size: 11px; color: var(--text-dim); line-height: 1.5; }

    /* â”€â”€ Deny Button â”€â”€ */
    .deny-btn {
      width: 100%;
      background: linear-gradient(135deg, #c0392b 0%, #ff3b5c 60%, #ff6b6b 100%);
      color: #fff;
      border: none; border-radius: 10px;
      padding: 15px 20px;
      font-family: var(--mono); font-size: 13px; font-weight: 700;
      letter-spacing: 0.1em; text-transform: uppercase;
      cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 9px;
      transition: all 0.2s; position: relative; overflow: hidden;
    }
    .deny-btn::before {
      content: ''; position: absolute; inset: 0;
      background: linear-gradient(135deg, transparent 30%, rgba(255,255,255,0.12) 50%, transparent 70%);
      transform: translateX(-100%); transition: transform 0.4s;
    }
    .deny-btn:hover::before { transform: translateX(100%); }
    .deny-btn:hover { box-shadow: 0 0 28px rgba(255,59,92,0.45); transform: translateY(-1px); }
    .deny-btn:active { transform: translateY(0); box-shadow: none; }
    .deny-btn:disabled {
      background: var(--surface2); color: var(--text-faint);
      cursor: not-allowed; box-shadow: none; transform: none; border: 1px solid var(--border);
    }
    .deny-btn.running {
      background: var(--surface2); color: var(--info);
      border: 1px solid var(--border); cursor: wait;
    }
    .deny-btn.done-state {
      background: var(--surface2); color: var(--success);
      border: 1px solid rgba(0,232,122,0.25); cursor: default;
    }

    .spinner {
      width: 14px; height: 14px; border: 2px solid currentColor;
      border-top-color: transparent; border-radius: 50%;
      animation: spin 0.8s linear infinite; display: none;
    }
    .deny-btn.running .spinner { display: block; }
    .deny-btn.running .btn-icon { display: none; }
    @keyframes spin { to { transform: rotate(360deg); } }

    /* â”€â”€ Results â”€â”€ */
    .results-section {
      border-top: 1px solid var(--border);
      max-height: 0; overflow: hidden; transition: max-height 0.4s ease;
    }
    .results-section.visible { max-height: 420px; overflow-y: auto; }
    .results-section::-webkit-scrollbar { width: 4px; }
    .results-section::-webkit-scrollbar-track { background: var(--bg); }
    .results-section::-webkit-scrollbar-thumb { background: var(--border2); border-radius: 2px; }

    /* Banner closed pill */
    .banner-status {
      margin: 0 16px 0;
      display: none;
      padding: 7px 12px;
      border-radius: 0 0 8px 8px;
      font-family: var(--mono);
      font-size: 10px;
      letter-spacing: 0.05em;
      text-align: center;
    }
    .banner-status.closed {
      display: block;
      background: var(--success-dim);
      color: var(--success);
      border: 1px solid rgba(0,232,122,0.2);
      border-top: none;
    }
    .banner-status.not-closed {
      display: block;
      background: var(--warn-dim);
      color: var(--warn);
      border: 1px solid rgba(255,184,0,0.2);
      border-top: none;
    }

    /* Stats bar */
    .stats-bar {
      display: grid; grid-template-columns: 1fr 1fr 1fr;
      gap: 1px; background: var(--border); border-top: 1px solid var(--border);
    }
    .stat-cell { background: var(--surface); padding: 10px 12px; text-align: center; }
    .stat-value { font-family: var(--mono); font-size: 20px; font-weight: 700; line-height: 1; margin-bottom: 3px; }
    .stat-value.v-removed { color: var(--accent); }
    .stat-value.v-kept    { color: var(--warn); }
    .stat-value.v-errors  { color: var(--text-dim); }
    .stat-label { font-size: 9px; color: var(--text-dim); text-transform: uppercase; letter-spacing: 0.08em; }

    /* Tabs */
    .result-tabs { display: flex; background: var(--surface); border-bottom: 1px solid var(--border); }
    .tab-btn {
      flex: 1; padding: 9px 8px; background: none; border: none;
      color: var(--text-dim); font-family: var(--mono); font-size: 10px;
      font-weight: 700; text-transform: uppercase; letter-spacing: 0.06em;
      cursor: pointer; border-bottom: 2px solid transparent; transition: all 0.2s;
    }
    .tab-btn:hover { color: var(--text); }
    .tab-btn.active         { color: var(--accent); border-bottom-color: var(--accent); background: var(--accent-dim); }
    .tab-btn.tab-kept.active  { color: var(--warn);   border-bottom-color: var(--warn);   background: var(--warn-dim); }
    .tab-btn.tab-err.active   { color: var(--text-dim);border-bottom-color: var(--text-dim);background: var(--surface2); }

    .tab-panel { display: none; padding: 8px; }
    .tab-panel.active { display: block; }

    .result-empty { padding: 20px; text-align: center; color: var(--text-faint); font-size: 11px; font-family: var(--mono); line-height: 1.6; }

    .result-item {
      display: flex; align-items: flex-start; gap: 8px;
      padding: 8px 10px; border-radius: 6px; margin-bottom: 4px;
      background: var(--surface2); border: 1px solid var(--border);
      transition: border-color 0.15s;
    }
    .result-item:hover { border-color: var(--border2); }
    .result-item:last-child { margin-bottom: 0; }
    .item-icon { font-size: 12px; flex-shrink: 0; margin-top: 1px; }
    .item-body { flex: 1; min-width: 0; }
    .item-label { font-size: 11.5px; color: var(--text); line-height: 1.4; word-break: break-word; }
    .item-cat {
      display: inline-block; font-family: var(--mono); font-size: 9px;
      background: var(--surface); border: 1px solid var(--border);
      border-radius: 3px; padding: 1px 5px; margin-top: 3px;
      text-transform: uppercase; letter-spacing: 0.05em; color: var(--text-faint);
    }
    .item-cat.consent     { color: var(--accent);  border-color: rgba(255,59,92,0.2);   background: var(--accent-dim); }
    .item-cat.legitimate  { color: var(--warn);    border-color: rgba(255,184,0,0.2);   background: var(--warn-dim); }
    .item-cat.vendor      { color: #a78bfa;        border-color: rgba(167,139,250,0.2); background: rgba(167,139,250,0.08); }
    .item-cat.mandatory   { color: var(--warn);    border-color: rgba(255,184,0,0.2);   background: var(--warn-dim); }

    /* Settings */
    .settings-toggle { background:none;border:none;cursor:pointer;color:var(--text-faint);font-size:14px;padding:0 4px;transition:color 0.2s; }
    .settings-toggle:hover { color:var(--text-dim); }
    .settings-drawer { background:var(--surface);border-top:1px solid var(--border);max-height:0;overflow:hidden;transition:max-height 0.3s ease; }
    .settings-drawer.open { max-height:220px; }
    .settings-inner { padding:10px 16px; }
    .setting-row { display:flex;align-items:center;justify-content:space-between;padding:7px 0;border-bottom:1px solid var(--border); }
    .setting-row:last-child { border-bottom:none; }
    .setting-label { font-size:12px;color:var(--text-dim);flex:1; }
    .setting-sub   { font-size:10px;color:var(--text-faint);margin-top:1px; }
    .toggle-switch { position:relative;width:36px;height:20px;flex-shrink:0; }
    .toggle-switch input { opacity:0;width:0;height:0; }
    .toggle-slider { position:absolute;inset:0;background:var(--border2);border-radius:10px;cursor:pointer;transition:0.2s; }
    .toggle-slider::before { content:'';position:absolute;height:14px;width:14px;left:3px;bottom:3px;background:white;border-radius:50%;transition:0.2s; }
    input:checked + .toggle-slider { background:var(--accent); }
    input:checked + .toggle-slider::before { transform:translateX(16px); }
    /* Donation */
    .donation-bar { background:linear-gradient(135deg,rgba(255,59,92,0.07),rgba(255,59,92,0.03));border-top:1px solid rgba(255,59,92,0.15);padding:8px 16px;display:flex;align-items:center;justify-content:space-between;gap:10px; }
    .donation-text { font-size:11px;color:var(--text-dim);flex:1; }
    .donation-btn { background:none;border:1px solid rgba(255,59,92,0.3);color:var(--accent);border-radius:5px;padding:4px 10px;font-size:10px;font-family:var(--mono);font-weight:700;cursor:pointer;letter-spacing:0.05em;white-space:nowrap;text-decoration:none;display:inline-block;transition:all 0.2s; }
    .donation-btn:hover { background:rgba(255,59,92,0.1);border-color:var(--accent); }
    .dismiss-btn { background:none;border:none;color:var(--text-faint);cursor:pointer;font-size:14px;padding:0;line-height:1; }
    .dismiss-btn:hover { color:var(--text-dim); }
    /* Footer */
    .footer {
      background: var(--surface); border-top: 1px solid var(--border);
      padding: 7px 16px; display: flex; align-items: center; justify-content: space-between;
    }
    .footer-time { font-family: var(--mono); font-size: 9px; color: var(--text-faint); }
    .footer-note { font-size: 9px; color: var(--text-faint); }
  </style>
</head>
<body>

  <div class="header">
    <div class="logo">
      <div class="logo-icon">ðŸš«</div>
      <div class="logo-text">
        <div class="logo-name">DENYSTEALTH</div>
        <div class="logo-sub">Privacy First</div>
      </div>
    </div>
    <div class="site-info">
      <div class="site-domain" id="siteDomain">â€”</div>
      <div id="cmpBadgeWrap"></div>
    </div>
  </div>

  <div class="action-area">
    <div class="scan-status">
      <div class="status-dot" id="statusDot"></div>
      <div class="status-text">
        <div class="status-label" id="statusLabel">Ready to deny all consents</div>
        <div class="status-detail" id="statusDetail">DenyStealthCookies removes non-essential tracking &amp; keeps only mandatory cookies</div>
      </div>
    </div>

    <div class="no-cmp-notice" id="noCmpNotice">
      <div class="no-cmp-title">âš  No standard CMP detected</div>
      <div class="no-cmp-text">No recognised consent banner found. DenyStealthCookies will still attempt to uncheck any toggles found on the page.</div>
    </div>

    <button class="deny-btn" id="denyBtn">
      <span class="btn-icon">ðŸš«</span>
      <span class="spinner"></span>
      <span id="btnText">Deny All Non-Essential Consents</span>
    </button>
  </div>

  <!-- Banner closed status (shown below button after scan) -->
  <div class="banner-status" id="bannerStatus"></div>

  <div class="results-section" id="resultsSection">
    <div class="stats-bar">
      <div class="stat-cell">
        <div class="stat-value v-removed" id="statRemoved">0</div>
        <div class="stat-label">Denied</div>
      </div>
      <div class="stat-cell">
        <div class="stat-value v-kept" id="statKept">0</div>
        <div class="stat-label">Kept (essential)</div>
      </div>
      <div class="stat-cell">
        <div class="stat-value v-errors" id="statErrors">0</div>
        <div class="stat-label">Errors</div>
      </div>
    </div>

    <div class="result-tabs">
      <button class="tab-btn active" data-tab="removed" id="tabRemoved">ðŸš« Denied</button>
      <button class="tab-btn tab-kept" data-tab="kept" id="tabKept">ðŸ”’ Kept</button>
      <button class="tab-btn tab-err" data-tab="errors" id="tabErrors">âš  Errors</button>
    </div>

    <div class="tab-panel active" id="panelRemoved">
      <div class="result-empty">Nothing denied yet.</div>
    </div>
    <div class="tab-panel" id="panelKept">
      <div class="result-empty">No essential items detected yet.</div>
    </div>
    <div class="tab-panel" id="panelErrors">
      <div class="result-empty">No errors.</div>
    </div>
  </div>

  <div class="footer">
    <div class="footer-time" id="footerTime"></div>
    <div style="display:flex;align-items:center;gap:8px;">
      <button class="settings-toggle" id="settingsToggle" title="Settings">&#9881;</button>
      <div class="footer-note">DenyStealthCookies v1.1</div>
    </div>
  </div>

  <!-- Donation bar -->
  <div class="donation-bar" id="donationBar" style="display:none">
    <div class="donation-text">&#10084; Free &amp; open source</div>
    <a class="donation-btn" href="https://paypal.me/your-paypal-username" target="_blank">&#36; PayPal</a>
    <a class="donation-btn" href="https://ko-fi.com/denystealth" target="_blank">&#9749; Ko-fi</a>
    <button class="dismiss-btn" id="dismissDonation">&#215;</button>
  </div>

  <!-- Settings drawer -->
  <div class="settings-drawer" id="settingsDrawer">
    <div class="settings-inner">
      <div class="setting-row">
        <div>
          <div class="setting-label">Anonymous telemetry</div>
          <div class="setting-sub">CMP type + count only. No URLs, no personal data. Off by default.</div>
        </div>
        <label class="toggle-switch">
          <input type="checkbox" id="telemetryToggle">
          <span class="toggle-slider"></span>
        </label>
      </div>
      <div class="setting-row">
        <div>
          <div class="setting-label">Auto-deny mode</div>
          <div class="setting-sub">Silently deny banners as pages load (zero clicks needed)</div>
        </div>
        <label class="toggle-switch">
          <input type="checkbox" id="autoModeToggle">
          <span class="toggle-slider"></span>
        </label>
      </div>
      <div class="setting-row">
        <div style="flex:1">
          <div class="setting-label">Privacy policy</div>
        </div>
        <a href="https://denystealth.io/privacy" target="_blank"
           style="font-size:10px;color:var(--accent);font-family:var(--mono);">View &#8599;</a>
      </div>
    </div>
  </div>

  <script src="popup.js"></script>
</body>
</html>
